/**
 * Artyom uses webkitSpeechRecognition && SpeechSynthesisUtterance property of Google Inc.
 * Requires browser with WebKit -  This object is only supported by Google Chrome and Apple Safari.
 * 
 * @version 0.9
 * @copyright 2015, Deutschland.
 * @author Carlos Delgado | 2015
 * @param {type} window
 * @see http://sdkcarlos.github.io/artyom.html
 * @returns {object}
 */
!function(a){"use strict";function h(){var h={},i=[];h.device=g,h.getVoices=function(){return a.speechSynthesis.getVoices()},h.getAvailableCommands=function(){for(var a=[],b=0;b<i.length;b++){var c=i[b],d={};d.indexes=c.indexes,c.smart&&(d.smart=!0),c.description&&(d.description=c.description),a.push(d)}return a},h.initialize=function(a){if("object"!=typeof a)return void console.error("You must give the configuration for start artyom properly.");if(a.lang){switch(a.lang){case"de":case"de-DE":f=e.german;break;case"en-GB":f=e.englishGB;break;case"pt":case"pt-br":case"pt-PT":f=e.brasilian;break;case"ru":case"ru-RU":f=e.russia;break;case"nl":case"nl-NL":f=e.holand;break;case"es":case"es-CO":case"es-ES":f=e.spanish;break;case"en":case"en-US":f=e.englishUSA;break;case"fr":case"fr-FR":f=e.france;break;case"it":case"it-IT":f=e.italian;break;case"jp":case"ja-JP":f=e.japanese;break;default:console.info("The given language for artyom is not supported yet. English has been set to default")}c.lang=a.lang}return a.continuous?(c.continuous=!0,d.restartRecognition=!0):(c.continuous=!1,d.restartRecognition=!1),h.is.number(a.speed)&&(c.speed=a.speed),a.executionKeyword&&(c.executionKeyword=a.executionKeyword),h.is.number(a.volume)&&(c.volume=a.volume),c.listen=a.listen,"undefined"!==a.debug&&(c.debug=a.debug),a.mode&&(c.mode=a.mode),c.listen===!0&&l(),!0},h.fatality=function(){return d.restartRecognition=!1,b.stop(),!0},h.addCommands=function(a){var b=function(a){i.push(a)};if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c]);else b(a);return!0},h.removeCommands=function(a){if("string"==typeof a){for(var b=[],c=0;c<i.length;c++){var d=i[c];d.indexes.indexOf(a)&&b.push(c)}for(var e=0;e<b.length;e++)i.splice(e,1)}return b},h.emptyCommands=function(){return i=[]},h.shutUp=function(){if("speechSynthesis"in a)do a.speechSynthesis.cancel();while(a.speechSynthesis.pending===!0)},h.getProperties=function(){return c};var j=function(a,b){var c=new CustomEvent(a,{detail:b});return document.dispatchEvent(c),c};h.when=function(a,b){document.addEventListener(a,function(a){b(a.detail)},!1)},h.getLanguage=function(a){if(a)switch(f){case"Google UK English Male":return"en-GB";case"Google espa\xf1ol":return"es";case"Google Deutsch":return"de";case"Google fran\xe7ais":return"fr";case"Google italiano":return"it";case"Google \u65e5\u672c\u4eba":return"jp";case"Google US English":return"en-US";case"Google portugu\xeas do Brasil":return"pt";case"Google \u0440\u0443\u0441\u0441\u043a\u0438\u0439":return"ru";case"Google Nederlands":return"nl"}switch(f){case"Google UK English Male":return"en-GB";case"Google espa\xf1ol":return"es-CO";case"Google Deutsch":return"de-DE";case"Google fran\xe7ais":return"fr-FR";case"Google italiano":return"it-IT";case"Google \u65e5\u672c\u4eba":return"ja-JP";case"Google US English":return"en-US";case"Google portugu\xeas do Brasil":return"pt-BR";case"Google \u0440\u0443\u0441\u0441\u043a\u0438\u0439":return"ru-RU";case"Google Nederlands":return"nl-NL"}};var k=function(b,d,e,g){var i=new SpeechSynthesisUtterance;i.text=b,i.volume=c.volume,i.rate=c.speed,f&&(i.voice=speechSynthesis.getVoices().filter(function(a){return a.name==f})[0]),g&&("function"==typeof g.onEnd&&i.addEventListener("end",function(){d>=e&&g.onEnd()}),"function"==typeof g.onStart&&i.addEventListener("start",function(){1==d&&g.onStart()})),h.debug(d+" text chunks processed succesfully out of "+e),a.speechSynthesis.speak(i)};h.say=function(a,b){if(h.speechSupported())if("undefined"!=typeof a.length)if(a.length>0){var f,d=a.split(","),e=a.split(".");f=d.length>e.length?d.filter(function(a){return a}):e.filter(function(a){return a}),f.forEach(function(a,c){var d=c+1;a&&k(a,d,f.length,b)}),c.helpers.lastSay={text:a,date:new Date},j("saySomething")}else h.debug("Artyom expects a string to say ... none given.","warn");else h.debug("Artyom expects a string to say ... "+typeof a+" given.","warn")},h.repeatLastSay=function(a){var b=c.helpers.lastSay;return a?b:void(null!=b&&h.say(b.text))},h.test=function(){"webkitSpeechRecognition"in a?(alert("I can hear you ! Initialize me now."),h.initialize({lang:"en-GB",listen:!1})):alert("Artyom can't listen to you in this browser. Speech Recognition is not supported in this browser."),"speechSynthesis"in a?h.say("1,2,3,4,5,6,7,8,9,10. Well, all is in order here.",{onEnd:function(){alert("The test of speech is over.")}}):alert("Artyom can't say nothing in this browser. Speech Synthesis is not supported in this browser.")},h.speechSupported=function(){return"speechSynthesis"in a},h.recognizingSupported=function(){return"webkitSpeechRecognition"in a};var l=function(){var a,e;if(b.continuous=!0,b.interimResults=!0,b.lang=c.lang,b.onstart=function(){h.debug("Event reached : onStart"),c.recognizing=!0,e=!0},b.onerror=function(b){"network"==b.error&&j("error",{code:"network",message:"Artyom needs internet to work properly"}),"no-speech"==b.error&&c.continuous===!1&&j("info",{code:"info_no_speech",message:"Artyom didn't hear anything. It will take a break."}),"audio-capture"==b.error&&(e=!1,j("error",{code:"audio-capture",message:"There's not any audiocapture device installed on this computer."})),"not-allowed"==b.error&&(e=!1,b.timeStamp-a<100?j("error",{code:"info_blocked",message:"Artyom needs the permision of the microphone, is blocked."}):j("error",{code:"info_denied",message:"Artyom needs the permision of the microphone, is denied"}))},b.onend=function(){j("FinishRecognition",{code:"artyom_dont_listen",message:"Artyom stop listening."}),d.restartRecognition===!0&&(e===!0?(b.start(),h.debug("Artyom initialization finished. Restarting","info")):console.error("Verify the microphone and check for the table of errors in sdkcarlos.github.io/sites/artyom.html to solve your problem. If you want to give your user a message when an error appears add an artyom listener")),c.recognizing=!1},b.onresult=function(a){if(i.length){var d=a.results.length;if(j("Recognition",{code:"artyom_listen",message:"Artyom is listening to you."}),"normal"==c.mode)for(var e=a.resultIndex;d>e;++e){var f=a.results[e][0].transcript;if(a.results[e].isFinal){var g=m(f.trim());if("function"==typeof c.helpers.redirectRecognizedTextOutput&&c.helpers.redirectRecognizedTextOutput(f,!0),g!==!1&&1==c.recognizing){h.debug("<< Executing Matching Recognition in normal mode>>"),b.stop(),c.recognizing=!1,g.wildcard?g.objeto.action(g.indice,g.wildcard.item,g.wildcard.full):g.objeto.action(g.indice);break}}else{if("function"==typeof c.helpers.redirectRecognizedTextOutput&&c.helpers.redirectRecognizedTextOutput(f,!1),"string"==typeof c.executionKeyword&&-1!=f.indexOf(c.executionKeyword)){var g=m(f.replace(c.executionKeyword,"").trim());if(g!==!1&&1==c.recognizing){h.debug("<< Executing command ordered by ExecutionKeyword >>","info"),b.stop(),c.recognizing=!1,g.wildcard?g.objeto.action(g.indice,g.wildcard.item,g.wildcard.full):g.objeto.action(g.indice);break}}h.debug("Normal mode : "+f)}}else if("quick"==c.mode)for(var e=a.resultIndex;d>e;++e){var f=a.results[e][0].transcript;if(a.results[e].isFinal){var g=m(f.trim());if("function"==typeof c.helpers.redirectRecognizedTextOutput&&c.helpers.redirectRecognizedTextOutput(f,!1),g!==!1&&1==c.recognizing){h.debug("<< Executing Matching Recognition in quick mode>>"),b.stop(),c.recognizing=!1,g.wildcard?g.objeto.action(g.indice,g.wildcard.item):g.objeto.action(g.indice);break}}else{var g=m(f.trim());if("function"==typeof c.helpers.redirectRecognizedTextOutput&&c.helpers.redirectRecognizedTextOutput(f,!0),g!==!1&&1==c.recognizing){h.debug("<< Executing Matching Recognition in quick mode>>"),b.stop(),c.recognizing=!1,g.wildcard?g.objeto.action(g.indice,g.wildcard.item):g.objeto.action(g.indice);break}}h.debug("Quick mode : "+f)}}},c.recognizing)b.stop(),h.debug("Voice recognition stopped");else try{b.start()}catch(f){console.warn("Fatal Error There's already a instance of me running in the background . It's recommendable to restart Google Chrome to fix this issue.")}};h.doInstruction=function(a){return console.warn("The name of the function artyom.doInstruction is deprecated and will be removed in the next version of artyom, please use artyom.simulateInstruction instead."),a&&"string"==typeof a?h.simulateInstruction(a):(console.warn("Cannot execute a non string command"),!1)},h.simulateInstruction=function(a){if(!a||"string"!=typeof a)return console.warn("Cannot execute a non string command"),!1;var b=m(a);return"object"!=typeof b?(console.warn("No command founded trying with "+a),!1):b.objeto?(b.objeto.smart?b.objeto.action(b.indice,b.wildcard.item,b.wildcard.full):b.objeto.action(b.indice),!0):void 0};var m=function(a){if(!a)return console.warn("Internal error: Execution of empty command"),!1;h.debug(">> "+a);for(var b=0;b<i.length;b++){for(var c=i[b],d=c.indexes,e=-1,f=0;f<d.length;f++){var g=d[f];if(c.smart){if(-1!=g.indexOf("*")){var j=g.split("*");if(j.length>2){console.warn("Artyom found a smart command with "+(j.length-1)+" wildcards. Artyom only support 1 wildcard for each command. Sorry");continue}var k=j[0],l=j[1];if(""==l||" "==l){if(-1!=a.indexOf(k)||-1!=a.toLowerCase().indexOf(k.toLowerCase())){var m=a.replace(k,"");m=m.toLowerCase().replace(k.toLowerCase(),""),e=parseInt(f)}}else if(!(-1==a.indexOf(k)&&-1==a.toLowerCase().indexOf(k.toLowerCase())||-1==a.indexOf(l)&&-1==a.toLowerCase().indexOf(l.toLowerCase()))){var m=a.replace(k,"").replace(l,"");m=m.toLowerCase().replace(k.toLowerCase(),"").replace(l.toLowerCase(),""),m=m.toLowerCase().replace(l.toLowerCase(),""),e=parseInt(f)}}else console.warn("Founded command marked as SMART but have no wildcard in the indexes, remove the SMART for prevent extensive memory consuming or add the wildcard *");if(e>=0){e=parseInt(f);break}}}if(e>=0)return{indice:e,objeto:c,wildcard:{item:m,full:a}}}for(var b=0;b<i.length;b++){for(var c=i[b],d=c.indexes,e=-1,f=0;f<d.length;f++){var g=d[f];if(!c.smart){if(a===g){h.debug(">> MATCHED FULL EXACT OPTION "+g+" AGAINST "+a+" WITH INDEX "+f+" IN COMMAND ","info"),e=parseInt(f);break}if(a.toLowerCase()===g.toLowerCase()){h.debug(">> MATCHED OPTION CHANGING ALL TO LOWERCASE "+g+" AGAINST "+a+" WITH INDEX "+f+" IN COMMAND ","info"),e=parseInt(f);break}}}if(e>=0)return{indice:e,objeto:c}}for(var b=0;b<i.length;b++){for(var c=i[b],d=c.indexes,e=-1,f=0;f<d.length;f++)if(!c.smart){var g=d[f];if(a.indexOf(g)>=0){h.debug(">> MATCHED INDEX EXACT OPTION "+g+" AGAINST "+a+" WITH INDEX "+f+" IN COMMAND ","info"),e=parseInt(f);break}if(a.toLowerCase().indexOf(g.toLowerCase())>=0){h.debug(">> MATCHED INDEX OPTION CHANGING ALL TO LOWERCASE "+g+" AGAINST "+a+" WITH INDEX "+f+" IN COMMAND ","info"),e=parseInt(f);break}}if(e>=0)return{indice:e,objeto:c}}return!1};return h.debug=function(a,b){if(c.debug===!0)switch(b){case"error":console.error(a);break;case"warn":console.warn(a);break;case"info":console.info(a);break;default:console.log(a)}},h.is={integer:function(a){return Number(a)===a&&0===a%1},"float":function(a){return a===Number(a)&&0!==a%1},"function":function(a){return"function"==typeof a?!0:!1},object:function(a){return"object"==typeof a?!0:!1},"boolean":function(a){return"boolean"==typeof a?!0:!1},array:function(a){return a.constructor===Array?!0:!1},number:function(a){return a===parseFloat(a)},odd:function(a){return h.is.number(a)&&1===Math.abs(a)%2},even:function(a){return h.is.number(a)&&0===a%2},jQueryObject:function(a){return a instanceof jQuery?!0:!1}},h.detectErrors=function(){return"file://"==a.location.origin?(console.error("Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."),{code:"artyom_error_localfile",message:"Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."}):h.device.isChrome?("https:"!=a.location.protocol&&console.warn("Artyom is not running in HTTPS protocol,running in protocol : "+a.location.protocol+" that means the browser will ask the permission of microphone too often. You need a HTTPS Connection if you want artyom in continuous mode !"),navigator.getUserMedia?!1:(console.error("Fatal Error Detected: It seems no microphone is available for the speechRecognition "),{code:"artyom_error_no_microphone",message:"Fatal Error Detected: It seems no microphone is available for the speechRecognition  "})):(console.error("Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "),{code:"artyom_error_browser_unsupported",message:"Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "})},h.redirectRecognizedTextOutput=function(a){return"function"!=typeof a?(console.warn("Expected function to handle the recognized text ..."),!1):(c.helpers.redirectRecognizedTextOutput=a,!0)},h.sayRandom=function(a){if(a instanceof Array){var b=Math.floor(Math.random()*a.length);return h.say(a[b]),{text:a[b],index:b}}return console.error("Random quotes must be in an array !"),null},h.newDictation=function(a){if(!h.recognizingSupported())return console.error("SpeechRecognition is not supported in this browser"),!1;var b=new webkitSpeechRecognition;return b.continuous=!0,b.interimResults=!0,b.lang=c.lang,b.onresult=function(b){for(var c="",d="",e=0;e<b.results.length;++e)b.results[e]["final"]?c+=b.results[e][0].transcript:d+=b.results[e][0].transcript;a.onResult&&a.onResult(d,c)},new function(){var c=b,d=!0,e=!1;this.onError=null,this.start=function(){a.continuous===!0&&(e=!0),c.onstart=function(){"function"==typeof a.onStart&&d===!0&&a.onStart()},c.onend=function(){e===!0?(d=!1,c.start()):(d=!0,"function"==typeof a.onEnd&&a.onEnd())},c.start()},this.stop=function(){e=!1,c.stop()},"function"==typeof a.onError&&(c.onerror=a.onError)}},h.newPrompt=function(a){"object"!=typeof a&&console.error("Expected the prompt configuration.");var b=Object.assign([],i);h.emptyCommands();var c={description:"Setting the artyom commands only for the prompt. The commands will be restored after the prompt finishes",indexes:a.options,action:function(c,d){i=b;var e=a.onMatch(c,d);return"function"!=typeof e?void console.error("onMatch function expects a returning function to be executed"):void e()}};a.smart&&(c.smart=!0),h.addCommands(c),"undefined"!=typeof a.beforePrompt&&a.beforePrompt(),h.say(a.question,{onStart:function(){"undefined"!=typeof a.onStartPrompt&&a.onStartPrompt()},onEnd:function(){"undefined"!=typeof a.onEndPrompt&&a.onEndPrompt()}})},h.extensions=function(){return{}},h.getVersion=function(){return"0.9"},h}if("speechSynthesis"in a&&speechSynthesis.getVoices(),"webkitSpeechRecognition"in a)var b=new webkitSpeechRecognition;var c={lang:"en-GB",recognizing:!1,continuous:!1,speed:1,volume:1,listen:!0,mode:"normal",debug:!1,helpers:{redirectRecognizedTextOutput:null,lastSay:null},executionKeyword:null},d={restartRecognition:!1},e={german:"Google Deutsch",spanish:"Google espa\xf1ol",italian:"Google italiano",japanese:"Google \u65e5\u672c\u4eba",englishUSA:"Google US English",englishGB:"Google UK English Male",brasilian:"Google portugu\xeas do Brasil",russia:"Google \u0440\u0443\u0441\u0441\u043a\u0438\u0439",holand:"Google Nederlands",france:"Google fran\xe7ais"},f="Google UK English Male",g={isMobile:!1,isChrome:!0};(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(g.isMobile=!0),-1==navigator.userAgent.indexOf("Chrome")&&(g.isChrome=!1),"undefined"==typeof artyom?a.artyom=Object.preventExtensions(new h):console.warn("Artyom seems to be loaded twice, it will work anyway because it will be not declared twice but is recommendable for increase the visualization time of your document")}(window);